define(["TFS/Work/RestClient","TFS/WorkItemTracking/RestClient","TFS/WorkItemTracking/Contracts","q"],function(e,t,i,o){return function(e){function t(o){if(i[o])return i[o].exports;var r=i[o]={exports:{},id:o,loaded:!1};return e[o].call(r.exports,r,r.exports,t),r.loaded=!0,r.exports}var i={};return t.m=e,t.c=i,t.p="",t(0)}({0:function(e,t,i){var o,r;o=[i,t,i(139),i(5),i(136),i(6)],r=function(e,t,i,o,r,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var l=function(){function e(e){this.WidgetHelpers=e,this.widgetConfigurationContext=null,this.$wiid=$("#wiid"),this.$wipropertyname=$("#wipropertyname"),this.$wicolorpropertyname=$("#wicolorpropertyname"),this.$color=$("#color"),this.$title=$("#title"),this.$dateFormat=$("dateFormat"),this.client=o.getClient(),this.clientwi=n.getClient(),this.clickOnSave=!1}return e.prototype.load=function(e,t){var i=this,o=this,r=$("#wiid"),n=$("#wipropertyname"),l=$("#wicolorpropertyname"),a=$("#color"),s=$("#title"),d=$("dateFormat");this.widgetConfigurationContext=t;var p=JSON.parse(e.customSettings.data);p&&p.wiId?r.val(p.wiId):r.val(""),p&&p.wiPropertyName?n.val(p.wiPropertyName):n.val(""),p&&p.wiColorPropertyName?l.val(p.wiColorPropertyName):l.val(""),p&&p.color?a.val(p.color):a.val(""),p&&p.title?s.val(p.title):s.val(""),p&&p.dateFormat?d.val(p.dateFormat):d.val("");var g=$("#linewi .validation-error-text");return o.$wiid.blur(function(){i.clientwi.getWorkItem(r.val()).then(function(e){console.log("Config:load step 10"),g.parent().css("visibility","hidden"),console.log("Config:load step 20"),i.getSortedFieldsList2(e).then(function(e){for(var t=0,o=e;t<o.length;t++){var r=o[t],l=document.createElement("option");l.innerHTML=r,l.value=r,i.$wipropertyname[0].appendChild(l)}p&&p.wiPropertyName?n.val(p.wiPropertyName):n.val("")}),console.log("Config:load step 25"),i.getSortedFieldsList2(e).then(function(e){for(var t=0,o=e;t<o.length;t++){var r=o[t],n=document.createElement("option");n.innerHTML=r,n.value=r,i.$wicolorpropertyname[0].appendChild(n)}p&&p.wiColorPropertyName?l.val(p.wiColorPropertyName):l.val("")}),console.log("Config:load step 30"),o.widgetConfigurationContext.notify(o.WidgetHelpers.WidgetEvent.ConfigurationChange,o.WidgetHelpers.WidgetEvent.Args(o.getCustomSettings()))},function(e){if(e.status="404")return g.text("This Work item dosn't exist."),g.parent().css("visibility","visible"),$(".btn-cta").attr("disabled","disabled"),o.WidgetHelpers.WidgetStatusHelper.Failure()})}),g=$("#linetitle .validation-error-text"),o.$title.blur(function(){console.log("Config:load linetitle:blur"),i.clientwi.getWorkItem(r.val()).then(function(e){g.parent().css("visibility","hidden"),o.widgetConfigurationContext.notify(o.WidgetHelpers.WidgetEvent.ConfigurationChange,o.WidgetHelpers.WidgetEvent.Args(o.getCustomSettings()))},function(e){if(e.status="404")return g.text("This Work item dosn't exist."),g.parent().css("visibility","visible"),$(".btn-cta").attr("disabled","disabled"),o.WidgetHelpers.WidgetStatusHelper.Failure()})}),g=$("#dropdownproperty .validation-error-text"),o.$wipropertyname.blur(function(){console.log("Config:load dropdownproperty:blur"),i.clientwi.getWorkItem(r.val()).then(function(e){g.parent().css("visibility","hidden"),o.widgetConfigurationContext.notify(o.WidgetHelpers.WidgetEvent.ConfigurationChange,o.WidgetHelpers.WidgetEvent.Args(o.getCustomSettings()))},function(e){if(e.status="404")return g.text("This Work item dosn't exist."),g.parent().css("visibility","visible"),$(".btn-cta").attr("disabled","disabled"),o.WidgetHelpers.WidgetStatusHelper.Failure()})}),g=$("#dropdowncolorproperty .validation-error-text"),o.$wicolorpropertyname.blur(function(){i.clientwi.getWorkItem(r.val()).then(function(e){g.parent().css("visibility","hidden"),o.widgetConfigurationContext.notify(o.WidgetHelpers.WidgetEvent.ConfigurationChange,o.WidgetHelpers.WidgetEvent.Args(o.getCustomSettings()))},function(e){if(e.status="404")return g.text("This Work item dosn't exist."),g.parent().css("visibility","visible"),$(".btn-cta").attr("disabled","disabled"),o.WidgetHelpers.WidgetStatusHelper.Failure()})}),g=$("#linedateformat .validation-error-text"),o.$dateFormat.blur(function(){console.log("Config:load linedateformat:blur"),i.clientwi.getWorkItem(r.val()).then(function(e){g.parent().css("visibility","hidden"),o.widgetConfigurationContext.notify(o.WidgetHelpers.WidgetEvent.ConfigurationChange,o.WidgetHelpers.WidgetEvent.Args(o.getCustomSettings()))},function(e){if(e.status="404")return g.text("This Work item dosn't exist."),g.parent().css("visibility","visible"),$(".btn-cta").attr("disabled","disabled"),o.WidgetHelpers.WidgetStatusHelper.Failure()})}),console.log("Config:load step 100"),this.clientwi.getWorkItem(r.val()).then(function(e){console.log("Config:load step 110"),i.getSortedFieldsList2(e).then(function(e){for(var t=0,o=e;t<o.length;t++){var r=o[t],l=document.createElement("option");l.innerHTML=r,l.value=r,i.$wipropertyname[0].appendChild(l)}p&&p.wiPropertyName?n.val(p.wiPropertyName):n.val("")}),i.getSortedFieldsList2(e).then(function(e){for(var t=0,o=e;t<o.length;t++){var r=o[t],n=document.createElement("option");n.innerHTML=r,n.value=r,i.$wicolorpropertyname[0].appendChild(n)}p&&p.wiColorPropertyName?l.val(p.wiColorPropertyName):l.val("")})}),o.WidgetHelpers.WidgetStatusHelper.Success()},e.prototype.isValidWI=function(){console.log("Config:isValidWI step 10");var e=$.Deferred();return""!==$("#wiid").val()?this.clientwi.getWorkItem($("#wiid").val()).then(function(t){e.resolve(!0)},function(t){(t.status="404")&&e.resolve(!1)}):e.resolve(!1),e.promise()},e.prototype.getSortedFieldsList=function(){var e=this;console.log("Config:getSortedFieldList step 10");var t=i.defer(),o=n.getClient();return o.getFields().then(function(i){e._fields=i.filter(function(e){return e.type===r.FieldType.Double||e.type===r.FieldType.Integer});var o=e._fields.map(function(e){return e.name}).sort(function(e,t){return e>t?1:e<t?-1:0});t.resolve(o)}),t.promise},e.prototype.getSortedFieldsList2=function(e){var t=this;console.log("Config:getSortedFieldList2 step 10");var o=i.defer(),r=n.getClient();return r.getFields(e.project).then(function(e){t._fields=e.filter(function(e){return e.type===e.type});var i=t._fields.map(function(e){return e.referenceName}).sort(function(e,t){return e>t?1:e<t?-1:0});o.resolve(i)}),o.promise},e.prototype.getSortedFieldsList3=function(e){var t=this;console.log("Config:getSortedFieldList3 step 10");var o=i.defer(),r=n.getClient();return r.getFields(e.project).then(function(e){t._fields=e.filter(function(e){return e.type===e.type});var i=t._fields.map(function(e){return e.referenceName}).sort(function(e,t){return e>t?1:e<t?-1:0});o.resolve(i)}),o.promise},e.prototype.getFieldName=function(e){var t=this._fields.filter(function(t){return t.referenceName===e});return t.length>0?t[0].name:null},e.prototype.getFieldReferenceName=function(e){var t=this._fields.filter(function(t){return t.name===e});return t.length>0?t[0].referenceName:null},e.prototype.getComboOptions=function(e,t,i){console.log("Config:getComboOptions step 10"),console.log("Config:getComboOptions step 11"),console.log("Config:getComboOptions initialField: "+i);var o=this;return console.log("Config:getComboOptions getFieldName(initialField): "+o.getFieldName(i)),{id:e,mode:"drop",source:t,enabled:!0,value:i,change:function(){o.widgetConfigurationContext.notify(o.WidgetHelpers.WidgetEvent.ConfigurationChange,o.WidgetHelpers.WidgetEvent.Args(o.getCustomSettings()));var e=this.value,t=this.getSelectedIndex()<0?null:o.getFieldReferenceName(e);switch(this._id){case"colorpropertyname":console.log("Config:getComboOptions fieldName: "+e+"; refname: "+t),o.$wicolorpropertyname.val(e)}}}},e.prototype.getCustomSettings=function(){console.log("Config:onSave wipropertyname: "+this.$wipropertyname.val()+"; wicolorpropertyname: "+this.$wicolorpropertyname.val());var e={data:JSON.stringify({wiId:$("#wiid").val(),wiPropertyName:$("#wipropertyname").val(),wiColorPropertyName:$("#wicolorpropertyname").val(),color:$("#color").val(),title:$("#title").val(),dateFormat:$("#dateFormat").val()})};return e},e.prototype.onSave=function(){if(""===$("#wiid").val()){var e=$("#linewi .validation-error-text");return e.text("The Id is required"),e.parent().css("visibility","visible"),this.WidgetHelpers.WidgetConfigurationSave.Invalid()}if(""===$("#title").val(),""===$("#wipropertyname").val()){var e=$("#lineproperty .validation-error-text");return e.text("The Property Name is required"),e.parent().css("visibility","visible"),this.WidgetHelpers.WidgetConfigurationSave.Invalid()}""===$("#wicolorpropertyname").val(),""===$("#color").val(),""===$("#dateFormat").val(),console.log("Config:onSave wipropertyname: "+this.$wipropertyname.val()),console.log("Config:onSave wicolorpropertyname: "+this.$wicolorpropertyname.val()),console.log("Config:onSave wipropertyname: "+$("#wipropertyname").val());var t=this.getCustomSettings();return this.WidgetHelpers.WidgetConfigurationSave.Valid(t)},e}();t.Configuration=l,VSS.require(["TFS/Dashboards/WidgetHelpers"],function(e){e.IncludeWidgetConfigurationStyles(),VSS.register("wipropertywidget-Configuration",function(){var t=new l(e);return t}),VSS.notifyLoadSucceeded()})}.apply(t,o),!(void 0!==r&&(e.exports=r))},5:function(t,i){t.exports=e},6:function(e,i){e.exports=t},136:function(e,t){e.exports=i},139:function(e,t){e.exports=o}})});