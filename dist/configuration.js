define(["TFS/Work/RestClient","TFS/WorkItemTracking/RestClient","TFS/WorkItemTracking/Contracts","VSS/Controls","VSS/Controls/Combos","q"],function(e,t,i,r,n,o){return function(e){function t(r){if(i[r])return i[r].exports;var n=i[r]={exports:{},id:r,loaded:!1};return e[r].call(n.exports,n,n.exports,t),n.loaded=!0,n.exports}var i={};return t.m=e,t.c=i,t.p="",t(0)}([function(e,t,i){var r,n;r=[i,t,i(11),i(9),i(10),i(4),i(6),i(5)],n=function(e,t,i,r,n,o,l,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=function(){function e(e){this.WidgetHelpers=e,this.widgetConfigurationContext=null,this.$wiid=$("#wiid"),this.$wipropertyname=$("#wipropertyname"),this.$wicolorpropertyname=$("#wicolorpropertyname"),this.$color=$("#color"),this.$title=$("#title"),this.client=o.getClient(),this.clientwi=s.getClient(),this.clickOnSave=!1}return e.prototype.load=function(e,t){var i=this,o=this,l=$("#wiid"),s=$("#wipropertyname"),a=$("#wicolorpropertyname"),d=$("#color"),p=$("#title");this.widgetConfigurationContext=t;var u=JSON.parse(e.customSettings.data);u&&u.wiId?l.val(u.wiId):l.val(""),u&&u.wiPropertyName?s.val(u.wiPropertyName):s.val(""),u&&u.wiColorPropertyName?a.val(u.wiColorPropertyName):a.val(""),u&&u.color?d.val(u.color):d.val(""),u&&u.title?p.val(u.title):p.val("");var c=$("#linewi .validation-error-text");return o.$wiid.blur(function(){i.clientwi.getWorkItem(l.val()).then(function(e){c.parent().css("visibility","hidden"),o.widgetConfigurationContext.notify(o.WidgetHelpers.WidgetEvent.ConfigurationChange,o.WidgetHelpers.WidgetEvent.Args(o.getCustomSettings()))},function(e){if(e.status="404")return c.text("This Work item dosn't exist."),c.parent().css("visibility","visible"),$(".btn-cta").attr("disabled","disabled"),o.WidgetHelpers.WidgetStatusHelper.Failure()})}),c=$("#linetitle .validation-error-text"),o.$title.blur(function(){i.clientwi.getWorkItem(l.val()).then(function(e){c.parent().css("visibility","hidden"),o.widgetConfigurationContext.notify(o.WidgetHelpers.WidgetEvent.ConfigurationChange,o.WidgetHelpers.WidgetEvent.Args(o.getCustomSettings()))},function(e){if(e.status="404")return c.text("This Work item dosn't exist."),c.parent().css("visibility","visible"),$(".btn-cta").attr("disabled","disabled"),o.WidgetHelpers.WidgetStatusHelper.Failure()})}),c=$("#lineproperty .validation-error-text"),o.$wipropertyname.blur(function(){i.clientwi.getWorkItem(l.val()).then(function(e){c.parent().css("visibility","hidden"),o.widgetConfigurationContext.notify(o.WidgetHelpers.WidgetEvent.ConfigurationChange,o.WidgetHelpers.WidgetEvent.Args(o.getCustomSettings()))},function(e){if(e.status="404")return c.text("This Work item dosn't exist."),c.parent().css("visibility","visible"),$(".btn-cta").attr("disabled","disabled"),o.WidgetHelpers.WidgetStatusHelper.Failure()})}),c=$("#linecolor .validation-error-text"),o.$wicolorpropertyname.blur(function(){i.clientwi.getWorkItem(l.val()).then(function(e){c.parent().css("visibility","hidden"),o.widgetConfigurationContext.notify(o.WidgetHelpers.WidgetEvent.ConfigurationChange,o.WidgetHelpers.WidgetEvent.Args(o.getCustomSettings()))},function(e){if(e.status="404")return c.text("This Work item dosn't exist."),c.parent().css("visibility","visible"),$(".btn-cta").attr("disabled","disabled"),o.WidgetHelpers.WidgetStatusHelper.Failure()})}),console.log("Work Item step 765"),this.clientwi.getWorkItem(l.val()).then(function(e){console.log("Work Item step 53436"),i.getSortedFieldsList2(e).then(function(e){r.create(n.Combo,s,i.getComboOptions("wipropertyname",e,s.val()))}),i.getSortedFieldsList2(e).then(function(e){r.create(n.Combo,a,i.getComboOptions("colorpropertyname",e,a.val()))})}),o.WidgetHelpers.WidgetStatusHelper.Success()},e.prototype.isValidWI=function(){var e=$.Deferred();return""!==$("#wiid").val()?this.clientwi.getWorkItem($("#wiid").val()).then(function(t){e.resolve(!0)},function(t){(t.status="404")&&e.resolve(!1)}):e.resolve(!1),e.promise()},e.prototype.getSortedFieldsList=function(){var e=this,t=i.defer(),r=s.getClient();return r.getFields().then(function(i){e._fields=i.filter(function(e){return e.type===l.FieldType.Double||e.type===l.FieldType.Integer});var r=e._fields.map(function(e){return e.name}).sort(function(e,t){return e>t?1:e<t?-1:0});t.resolve(r)}),t.promise},e.prototype.getSortedFieldsList2=function(e){var t=this,r=i.defer(),n=s.getClient();return n.getFields(e.project).then(function(e){t._fields=e.filter(function(e){return e.type===e.type});var i=t._fields.map(function(e){return e.referenceName}).sort(function(e,t){return e>t?1:e<t?-1:0});r.resolve(i)}),r.promise},e.prototype.getFieldName=function(e){var t=this._fields.filter(function(t){return t.referenceName===e});return t.length>0?t[0].name:null},e.prototype.getFieldReferenceName=function(e){var t=this._fields.filter(function(t){return t.name===e});return t.length>0?t[0].referenceName:null},e.prototype.getComboOptions=function(e,t,i){var r=this;return{id:e,mode:"drop",source:t,enabled:!0,value:r.getFieldName(i),change:function(){var e=this.getText(),t=this.getSelectedIndex()<0?null:r.getFieldReferenceName(e);switch(this._id){case"colorpropertyname":console.log("Work Property 37464: "+e),console.log("Work Property 37464: "+t),r.$wicolorpropertyname.val(e)}}}},e.prototype.getCustomSettings=function(){var e={data:JSON.stringify({wiId:$("#wiid").val(),wiPropertyName:$("#wipropertyname").val(),wiColorPropertyName:$("#wicolorpropertyname").val(),color:$("#color").val(),title:$("#title").val()})};return e},e.prototype.onSave=function(){if(""===$("#wiid").val()){var e=$("#linewi .validation-error-text");return e.text("The Id is required"),e.parent().css("visibility","visible"),this.WidgetHelpers.WidgetConfigurationSave.Invalid()}if(""===$("#title").val(),""===$("#wipropertyname").val()){var e=$("#lineproperty .validation-error-text");return e.text("The Property Name is required"),e.parent().css("visibility","visible"),this.WidgetHelpers.WidgetConfigurationSave.Invalid()}""===$("#wicolorpropertyname").val(),""===$("#color").val(),console.log("Work Property "+this.$wipropertyname.val()),console.log("Work Property "+this.$wicolorpropertyname.val()),console.log("Work Property "+$("#wipropertyname").val());var t=this.getCustomSettings();return this.WidgetHelpers.WidgetConfigurationSave.Valid(t)},e}();t.Configuration=a,VSS.require(["TFS/Dashboards/WidgetHelpers"],function(e){e.IncludeWidgetConfigurationStyles(),VSS.register("widetailswidget-Configuration",function(){var t=new a(e);return t}),VSS.notifyLoadSucceeded()})}.apply(t,r),!(void 0!==n&&(e.exports=n))},,,,function(t,i){t.exports=e},function(e,i){e.exports=t},function(e,t){e.exports=i},,,function(e,t){e.exports=r},function(e,t){e.exports=n},function(e,t){e.exports=o}])});