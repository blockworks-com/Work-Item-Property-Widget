define(["TFS/Work/RestClient","TFS/WorkItemTracking/RestClient","TFS/WorkItemTracking/Contracts","q"],function(e,t,i,n){return function(e){function t(n){if(i[n])return i[n].exports;var o=i[n]={exports:{},id:n,loaded:!1};return e[n].call(o.exports,o,o.exports,t),o.loaded=!0,o.exports}var i={};return t.m=e,t.c=i,t.p="",t(0)}({0:function(e,t,i){var n,o;n=[i,t,i(139),i(5),i(136),i(6),i(3),i(4)],o=function(e,t,i,n,o,r,a,l){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var s=function(){function e(e){this.WidgetHelpers=e,this.widgetConfigurationContext=null,this.$wiid=$("#wiid"),this.$wipropertyname=$("#wipropertyname"),this.$wicolorpropertyname=$("#wicolorpropertyname"),this.$color=$("#color"),this.$title=$("#title"),this.$dateFormat=$("dateFormat"),this.$enableTelemetry=$("enableTelemetry"),this.client=n.getClient(),this.clientwi=r.getClient(),this.clickOnSave=!1}return e.prototype.load=function(e,t){var i=this;a.TelemetryClient.getClient(l.settings).trackPageView("Config");var n=this,o=$("#wiid"),r=$("#wipropertyname"),s=$("#wicolorpropertyname"),d=$("#color"),c=$("#title"),p=$("dateFormat"),g=$("enableTelemetry");this.widgetConfigurationContext=t;var u=JSON.parse(e.customSettings.data);u&&u.wiId?o.val(u.wiId):o.val(""),u&&u.wiPropertyName?r.val(u.wiPropertyName):r.val(""),u&&u.wiColorPropertyName?s.val(u.wiColorPropertyName):s.val(""),u&&u.color?d.val(u.color):d.val(""),u&&u.title?c.val(u.title):c.val(""),u&&u.dateFormat?p.val(u.dateFormat):p.val(""),u&&u.enableTelemetry?g.prop("checked",u.enableTelemetry):g.prop("checked",!0);var f=$("#linewi .validation-error-text");return n.$wiid.blur(function(){i.clientwi.getWorkItem(o.val()).then(function(e){console.log("Config:load step 10"),f.parent().css("visibility","hidden"),console.log("Config:load step 20"),i.getSortedFieldsList2(e).then(function(e){for(var t=0,n=e;t<n.length;t++){var o=n[t],a=document.createElement("option");a.innerHTML=o,a.value=o,i.$wipropertyname[0].appendChild(a)}u&&u.wiPropertyName?r.val(u.wiPropertyName):r.val("")}),console.log("Config:load step 25"),i.getSortedFieldsList2(e).then(function(e){for(var t=0,n=e;t<n.length;t++){var o=n[t],r=document.createElement("option");r.innerHTML=o,r.value=o,i.$wicolorpropertyname[0].appendChild(r)}u&&u.wiColorPropertyName?s.val(u.wiColorPropertyName):s.val("")}),console.log("Config:load step 30"),n.widgetConfigurationContext.notify(n.WidgetHelpers.WidgetEvent.ConfigurationChange,n.WidgetHelpers.WidgetEvent.Args(n.getCustomSettings()))},function(e){if(e.status="404")return f.text("This Work item dosn't exist."),f.parent().css("visibility","visible"),$(".btn-cta").attr("disabled","disabled"),n.WidgetHelpers.WidgetStatusHelper.Failure()})}),f=$("#linetitle .validation-error-text"),n.$title.blur(function(){console.log("Config:load linetitle:blur"),i.clientwi.getWorkItem(o.val()).then(function(e){f.parent().css("visibility","hidden"),n.widgetConfigurationContext.notify(n.WidgetHelpers.WidgetEvent.ConfigurationChange,n.WidgetHelpers.WidgetEvent.Args(n.getCustomSettings()))},function(e){if(e.status="404")return f.text("This Work item dosn't exist."),f.parent().css("visibility","visible"),$(".btn-cta").attr("disabled","disabled"),n.WidgetHelpers.WidgetStatusHelper.Failure()})}),f=$("#dropdownproperty .validation-error-text"),n.$wipropertyname.blur(function(){console.log("Config:load dropdownproperty:blur"),i.clientwi.getWorkItem(o.val()).then(function(e){f.parent().css("visibility","hidden"),n.widgetConfigurationContext.notify(n.WidgetHelpers.WidgetEvent.ConfigurationChange,n.WidgetHelpers.WidgetEvent.Args(n.getCustomSettings()))},function(e){if(e.status="404")return f.text("This Work item dosn't exist."),f.parent().css("visibility","visible"),$(".btn-cta").attr("disabled","disabled"),n.WidgetHelpers.WidgetStatusHelper.Failure()})}),f=$("#dropdowncolorproperty .validation-error-text"),n.$wicolorpropertyname.blur(function(){i.clientwi.getWorkItem(o.val()).then(function(e){f.parent().css("visibility","hidden"),n.widgetConfigurationContext.notify(n.WidgetHelpers.WidgetEvent.ConfigurationChange,n.WidgetHelpers.WidgetEvent.Args(n.getCustomSettings()))},function(e){if(e.status="404")return f.text("This Work item dosn't exist."),f.parent().css("visibility","visible"),$(".btn-cta").attr("disabled","disabled"),n.WidgetHelpers.WidgetStatusHelper.Failure()})}),f=$("#linedateformat .validation-error-text"),n.$dateFormat.blur(function(){console.log("Config:load linedateformat:blur"),i.clientwi.getWorkItem(o.val()).then(function(e){f.parent().css("visibility","hidden"),n.widgetConfigurationContext.notify(n.WidgetHelpers.WidgetEvent.ConfigurationChange,n.WidgetHelpers.WidgetEvent.Args(n.getCustomSettings()))},function(e){if(e.status="404")return f.text("This Work item dosn't exist."),f.parent().css("visibility","visible"),$(".btn-cta").attr("disabled","disabled"),n.WidgetHelpers.WidgetStatusHelper.Failure()})}),f=$("#lineenableTelemetry .validation-error-text"),n.$enableTelemetry.blur(function(){console.log("Config:load lineenableTelemetry:blur"),a.TelemetryClient.getClient(l.settings).trackPageView("enableTelemetry"),n.$enableTelemetry?a.TelemetryClient.getClient(l.settings).trackEvent("Telemetry Disabled"):a.TelemetryClient.getClient(l.settings).trackEvent("Telemetry Enabled"),n.widgetConfigurationContext.notify(n.WidgetHelpers.WidgetEvent.ConfigurationChange,n.WidgetHelpers.WidgetEvent.Args(n.getCustomSettings()))}),console.log("Config:load step 100"),this.clientwi.getWorkItem(o.val()).then(function(e){console.log("Config:load step 110"),i.getSortedFieldsList2(e).then(function(e){for(var t=0,n=e;t<n.length;t++){var o=n[t],a=document.createElement("option");a.innerHTML=o,a.value=o,i.$wipropertyname[0].appendChild(a)}u&&u.wiPropertyName?r.val(u.wiPropertyName):r.val("")}),i.getSortedFieldsList2(e).then(function(e){for(var t=0,n=e;t<n.length;t++){var o=n[t],r=document.createElement("option");r.innerHTML=o,r.value=o,i.$wicolorpropertyname[0].appendChild(r)}u&&u.wiColorPropertyName?s.val(u.wiColorPropertyName):s.val("")})}),n.WidgetHelpers.WidgetStatusHelper.Success()},e.prototype.isValidWI=function(){console.log("Config:isValidWI step 10");var e=$.Deferred();return""!==$("#wiid").val()?this.clientwi.getWorkItem($("#wiid").val()).then(function(t){e.resolve(!0)},function(t){(t.status="404")&&e.resolve(!1)}):e.resolve(!1),e.promise()},e.prototype.getSortedFieldsList=function(){var e=this;console.log("Config:getSortedFieldList step 10");var t=i.defer(),n=r.getClient();return n.getFields().then(function(i){e._fields=i.filter(function(e){return e.type===o.FieldType.Double||e.type===o.FieldType.Integer});var n=e._fields.map(function(e){return e.name}).sort(function(e,t){return e>t?1:e<t?-1:0});t.resolve(n)}),t.promise},e.prototype.getSortedFieldsList2=function(e){var t=this;console.log("Config:getSortedFieldList2 step 10");var n=i.defer(),o=r.getClient();return o.getFields(e.project).then(function(e){t._fields=e.filter(function(e){return e.type===e.type});var i=t._fields.map(function(e){return e.referenceName}).sort(function(e,t){return e>t?1:e<t?-1:0});n.resolve(i)}),n.promise},e.prototype.getSortedFieldsList3=function(e){var t=this;console.log("Config:getSortedFieldList3 step 10");var n=i.defer(),o=r.getClient();return o.getFields(e.project).then(function(e){t._fields=e.filter(function(e){return e.type===e.type});var i=t._fields.map(function(e){return e.referenceName}).sort(function(e,t){return e>t?1:e<t?-1:0});n.resolve(i)}),n.promise},e.prototype.getFieldName=function(e){var t=this._fields.filter(function(t){return t.referenceName===e});return t.length>0?t[0].name:null},e.prototype.getFieldReferenceName=function(e){var t=this._fields.filter(function(t){return t.name===e});return t.length>0?t[0].referenceName:null},e.prototype.getComboOptions=function(e,t,i){console.log("Config:getComboOptions step 10"),console.log("Config:getComboOptions step 11"),console.log("Config:getComboOptions initialField: "+i);var n=this;return console.log("Config:getComboOptions getFieldName(initialField): "+n.getFieldName(i)),{id:e,mode:"drop",source:t,enabled:!0,value:i,change:function(){n.widgetConfigurationContext.notify(n.WidgetHelpers.WidgetEvent.ConfigurationChange,n.WidgetHelpers.WidgetEvent.Args(n.getCustomSettings()));var e=this.value,t=this.getSelectedIndex()<0?null:n.getFieldReferenceName(e);switch(this._id){case"colorpropertyname":console.log("Config:getComboOptions fieldName: "+e+"; refname: "+t),n.$wicolorpropertyname.val(e)}}}},e.prototype.getCustomSettings=function(){console.log("Config:onSave wipropertyname: "+this.$wipropertyname.val()+"; wicolorpropertyname: "+this.$wicolorpropertyname.val()+"; enableTelemetry: "+this.$enableTelemetry.is(":checked"));var e={data:JSON.stringify({wiId:$("#wiid").val(),wiPropertyName:$("#wipropertyname").val(),wiColorPropertyName:$("#wicolorpropertyname").val(),color:$("#color").val(),title:$("#title").val(),dateFormat:$("#dateFormat").val(),enableTelemetry:$("#enableTelemetry").is(":checked")})};return e},e.prototype.onSave=function(){if(""===$("#wiid").val()){var e=$("#linewi .validation-error-text");return e.text("The Id is required"),e.parent().css("visibility","visible"),this.WidgetHelpers.WidgetConfigurationSave.Invalid()}if(""===$("#title").val(),""===$("#wipropertyname").val()){var e=$("#lineproperty .validation-error-text");return e.text("The Property Name is required"),e.parent().css("visibility","visible"),this.WidgetHelpers.WidgetConfigurationSave.Invalid()}""===$("#wicolorpropertyname").val(),""===$("#color").val(),""===$("#dateFormat").val(),""===$("#enableTelemetry").val(),console.log("Config:onSave wipropertyname: "+this.$wipropertyname.val()),console.log("Config:onSave wicolorpropertyname: "+this.$wicolorpropertyname.val()),console.log("Config:onSave wipropertyname: "+$("#wipropertyname").val());var t=this.getCustomSettings();return this.WidgetHelpers.WidgetConfigurationSave.Valid(t)},e}();t.Configuration=s,VSS.require(["TFS/Dashboards/WidgetHelpers"],function(e){e.IncludeWidgetConfigurationStyles(),VSS.register("wipropertywidget-Configuration",function(){var t=new s(e);return t}),VSS.notifyLoadSucceeded()})}.apply(t,n),!(void 0!==o&&(e.exports=o))},2:function(e,t,i){var n,o;n=[i,t],o=function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(){}return e._createLazyMethod=function(t){var i=window[e.appInsightsName];i[t]=function(){var e=arguments;i.queue?i.queue.push(function(){return i[t].apply(i,e)}):i[t].apply(i,e)}},e._defineLazyMethods=function(){var t=window[e.appInsightsName];try{t.cookie=document.cookie}catch(e){}t.queue=[];for(var i=["clearAuthenticatedUserContext","flush","setAuthenticatedUserContext","startTrackEvent","startTrackPage","stopTrackEvent","stopTrackPage","trackDependency","trackEvent","trackException","trackMetric","trackPageView","trackTrace"];i.length;)e._createLazyMethod(i.pop())},e._download=function(t){e.appInsightsInstance.config=t;var i=window[e.appInsightsName];if(i.queue||(i.queue=[]),setTimeout(function(){var e=document.createElement("script");e.src=t.url||"https://az416426.vo.msecnd.net/scripts/a/ai.0.js",document.head.appendChild(e)}),!t.disableExceptionTracking){var n="onerror";e._createLazyMethod("_"+n);var o=window[n];window[n]=function(e,t,r,a,l){var s=o&&o(e,t,r,a,l);return s!==!0&&i["_"+n](e,t,r,a,l),s}}},Object.defineProperty(e,"appInsightsInstance",{get:function(){if("undefined"!=typeof window)return window[e.appInsightsName]||(window[e.appInsightsName]={downloadAndSetup:e._download,_defineLazyMethods:e._defineLazyMethods},e._defineLazyMethods()),window[e.appInsightsName]},enumerable:!0,configurable:!0}),e}();i.appInsightsInitialized=!1,i.appInsightsName="appInsights",t.AppInsights=i.appInsightsInstance}.apply(t,n),!(void 0!==o&&(e.exports=o))},3:function(e,t,i){var n,o;n=[i,t,i(2)],o=function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(){this.disableTelemetry="false",this.disableAjaxTracking="false",this.enableDebug="false"}return e}();t.TelemetryClientSettings=n;var o=function(){function e(){this.IsAvailable=!0}return e.getClient=function(t){return this._instance||(console.log("Creating new TelemetryClient!"),this._instance=new e,this._instance.Init(t)),this._instance},e.prototype.Init=function(e){console.log("TelemetryClient settings key: "+e.key.substring(0,8)+"************"),console.log("TelemetryClient settings extension context: "+e.extensioncontext),console.log("TelemetryClient settings disableTelemetry: "+("true"===e.disableTelemetry)),console.log("TelemetryClient settings disableAjaxTracking: "+("true"===e.disableAjaxTracking)),console.log("TelemetryClient settings enableDebug: "+("true"===e.enableDebug));var t={instrumentationKey:e.key,disableTelemetry:"true"===e.disableTelemetry,disableAjaxTracking:"true"===e.disableAjaxTracking,enableDebug:"true"===e.enableDebug};this.ExtensionContext=e.extensioncontext;try{var n=VSS.getWebContext();i.AppInsights.downloadAndSetup(t),i.AppInsights.setAuthenticatedUserContext(n.user.id,n.collection.id)}catch(e){console.log(e)}},e.prototype.trackPageView=function(e,t,n,o,r){try{i.AppInsights.trackPageView(this.ExtensionContext+"."+e,t,n,o,r),i.AppInsights.flush()}catch(e){console.log(e)}},e.prototype.trackEvent=function(e,t,n){try{console.log("Tracking event: "+this.ExtensionContext+"."+e),i.AppInsights.trackEvent(this.ExtensionContext+"."+e,t,n),i.AppInsights.flush()}catch(e){console.log(e)}},e.prototype.trackException=function(e,t,n,o){try{console.error(e);var r={name:this.ExtensionContext+"."+t,message:e};i.AppInsights.trackException(r,t,n,o),i.AppInsights.flush()}catch(e){console.log(e)}},e.prototype.trackMetric=function(e,t,n,o,r,a){try{i.AppInsights.trackMetric(this.ExtensionContext+"."+e,t,n,o,r,a),i.AppInsights.flush()}catch(e){console.log(e)}},e}();t.TelemetryClient=o}.apply(t,n),!(void 0!==o&&(e.exports=o))},4:function(e,t,i){var n,o;n=[i,t],o=function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.settings={key:"e4104431-5dae-465d-b7dc-cbe5bb367d95",extensioncontext:"WorkItemPropertyWidget",disableTelemetry:"false",disableAjaxTracking:"__disableAjaxTracking__",enableDebug:"__enableDebug__"}}.apply(t,n),!(void 0!==o&&(e.exports=o))},5:function(t,i){t.exports=e},6:function(e,i){e.exports=t},136:function(e,t){e.exports=i},139:function(e,t){e.exports=n}})});